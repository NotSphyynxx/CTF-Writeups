# ðŸ”’ MAT247 - CTF Challenge Writeup

**Challenge**: MAT247  
**Category**: Crypto  
**Status**: âœ… Solved   
**Flag**: `uoftctf{jus7_4_s1mple_tr4nslation_t0_GF(p^12)}` 


# MAT247
**Posted Jan 10, 2026**

## Overview
The challenge provides a Python script `chall.py` and an output file `output.txt`.
The script defines a large prime $p$ and a $12 \times 12$ matrix $A$ over $GF(p)$.
It generates the flag bits one by one using two different methods:

```python
if bit == '0':
    print(gen_commuting_matrix(A))
else:
    print(np.linalg.matrix_power(A, random.randrange(p**12-1)))
```

Our task is to determine, for each of the 368 output matrices, whether it was generated as a general commuting matrix (Bit 0) or a power of $A$ (Bit 1).

## Idea
The problem statement hints at the structure of matrices commuting with $A$: "S = p(T) for some polynomial T".
We analyzed the matrix $A$ and found its characteristic polynomial is **irreducible** over $GF(p)$.
This means the subalgebra generated by $A$ is isomorphic to the finite field $GF(p^{12})$.
All matrices commuting with $A$ are elements of this field.

- **Bit 1**: $S = A^k$. This is an element of the cyclic subgroup generated by $A$.
- **Bit 0**: $S$ is a random element of $GF(p^{12})^*$.

The multiplicative group $GF(p^{12})^*$ has order $N = p^{12}-1$.
We can use the **subgroup membership problem** to distinguish the two cases.
We found small prime factors $q$ of $N$ such that $A^{(N/q)} = I$ (the identity matrix).
This implies $A$ lies in a subgroup of index $q$. Any power $A^k$ must also satisfy $(A^k)^{(N/q)} = I$.

However, a random element of $GF(p^{12})^*$ satisfies this condition with probability only $1/q$.
If a challenge matrix $S$ satisfies $S^{(N/q)} \neq I$, it **cannot** be a power of $A$ (implied Bit 0).
If it satisfies the condition for several large $q$, it is almost certainly a power of $A$ (Bit 1).

## Solve
We implemented a solver to find suitable factors $q$.
We identified $q \in \{2, 3, 17, 26119\}$ as valid distinguishers (where $A^{(N/q)} = I$).
The factor 26119 provided a very strong discriminator ($p \approx 4 \times 10^{-5}$ for false positives).

We processed the 368 matrices in parallel chunks.
Initially, using only small factors (2, 3, 17), we encountered a meaningful ambiguity where the character `t` was misidentified as `|` due to a probabilistic false positive (a random matrix happened to pass the checks).
By adding the factor $q=26119$, we correctly resolved the bits:

- **False Positive**: `|` (Bit pattern `01111100`)
- **Corrected**: `t` (Bit pattern `01110100`)

The bit difference confirmed that one matrix was Random (Bit 0) but previously guessed as Power (Bit 1).

Putting it all together, we decoded the binary string.

```bash
$ python3 solve.py
...
Flag: uoftctf{jus7_4_s1mple_tr4nslation_t0_GF(p^12)}
```
